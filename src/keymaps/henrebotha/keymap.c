// v1.7.2

#include QMK_KEYBOARD_H
#include "version.h"

#define PERMISSIVE_HOLD

#define CTL_ESC CTL_T(KC_ESC)
#define RSFT_MI RSFT_T(KC_MINUS)
#define LSFT_TA LSFT_T(KC_TAB)

enum custom_keycodes {
  PLACEHOLDER = SAFE_RANGE, // can always be here
  SW_TASK,
  CH_UNSA,
};

enum layers {
  LAYER_HOME = 0,
  LAYER_WORKMAN,
  LAYER_GAMING,
  LAYER_FUNCTION,
  LAYER_TMUX,
  LAYER_MIDI,
  LAYER_GS_GGX2,
  LAYER_GS_SCB,
  LAYER_GS_TAL,
  LAYER_GS_ARCUS
};

#define OSL_H OSL(LAYER_HOME)
#define OSL_W OSL(LAYER_WORKMAN)
#define OSL_G OSL(LAYER_GAMING)
#define OSL_F OSL(LAYER_FUNCTION)
#define OSL_T OSL(LAYER_TMUX)
#define OSL_M OSL(LAYER_MIDI)
#define OSL_GG2 OSL(LAYER_GS_GGX2)
#define OSL_SCB OSL(LAYER_GS_SCB)
#define OSL_TAL OSL(LAYER_GS_TAL)
#define OSL_GSA OSL(LAYER_GS_ARCUS)

#define TG_H TG(LAYER_HOME)
#define TG_W TG(LAYER_WORKMAN)
#define TG_G TG(LAYER_GAMING)
#define TG_F TG(LAYER_FUNCTION)
#define TG_T TG(LAYER_TMUX)
#define TG_M TG(LAYER_MIDI)
#define TG_GGX2 TG(LAYER_GS_GGX2)
#define TG_SCB TG(LAYER_GS_SCB)
#define TG_TAL TG(LAYER_GS_TAL)
#define TG_GSA TG(LAYER_GS_ARCUS)

#define TO_H TO(LAYER_HOME)
#define TO_W TO(LAYER_WORKMAN)
#define TO_G TO(LAYER_GAMING)
#define TO_F TO(LAYER_FUNCTION)
#define TO_T TO(LAYER_TMUX)
#define TO_M TO(LAYER_MIDI)
#define TO_GGX2 TO(LAYER_GS_GGX2)
#define TO_SCB TO(LAYER_GS_SCB)
#define TO_TAL TO(LAYER_GS_TAL)
#define TO_GSA TO(LAYER_GS_ARCUS)

const uint16_t PROGMEM keymaps[][MATRIX_ROWS][MATRIX_COLS] = {

  // home layer, generic version
  [LAYER_HOME] = LAYOUT_ergodox_pretty(
// ╭───────┬───────┬───────┬───────┬───────┬───────┬───────╮      ╭───────┬───────┬───────┬───────┬───────┬───────┬───────╮
    KC_GRV ,KC_1   ,KC_2   ,KC_3   ,KC_4   ,KC_5   ,TG_W   ,       XXXXXXX,KC_6   ,KC_7   ,KC_8   ,KC_9   ,KC_0   ,KC_BSPC,
// ├───────┼───────┼───────┼───────┼───────┼───────┼───────┤      ├───────┼───────┼───────┼───────┼───────┼───────┼───────┤
    KC_TAB ,KC_Q   ,KC_W   ,KC_E   ,KC_R   ,KC_T   ,TG_M   ,       XXXXXXX,KC_Y   ,KC_U   ,KC_I   ,KC_O   ,KC_P   ,KC_BSLS,
// ├───────┼───────┼───────┼───────┼───────┼───────┼───────┤      ├───────┼───────┼───────┼───────┼───────┼───────┼───────┤
    CTL_ESC,KC_A   ,KC_S   ,KC_D   ,KC_F   ,KC_G   ,                       KC_H   ,KC_J   ,KC_K   ,KC_L   ,KC_SCLN,KC_QUOT,
// ├───────┼───────┼───────┼───────┼───────┼───────┤       │      │       ├───────┼───────┼───────┼───────┼───────┼───────┤
    KC_LGUI,KC_Z   ,KC_X   ,KC_C   ,KC_V   ,KC_B   ,KC_MINS,       KC_EQL ,KC_N   ,KC_M   ,KC_COMM,KC_DOT ,KC_SLSH,KC_RGUI,
// ├───────┼───────┼───────┼───────┼───────┼───────┴───────╯      ╰───────┴───────┼───────┼───────┼───────┼───────┼───────┤
    KC_HYPR,SW_TASK,QK_LEAD,OSL_T  ,OSL_F  ,                                       OSL_F  ,OSL_T  ,QK_LEAD,XXXXXXX,KC_HYPR,
// ╰───────┴───────┴───────┴───────┴───────╯ ╭───────┬───────╮  ╭───────┬───────╮ ╰───────┴───────┴───────┴───────┴───────╯
                                              KC_MUTE,KC_VOLU,   KC_MPRV,KC_MNXT,
//                                   ╭───────┼───────┼───────┤  ├───────┼───────┼───────╮
                                                      KC_VOLD,   KC_MPLY,
//                                   │       │       ├───────┤  ├───────┤       │       │
                                      LSFT_TA,KC_SPC ,KC_LALT,   KC_RALT,KC_ENT ,RSFT_MI
//                                   ╰───────┴───────┴───────╯  ╰───────┴───────┴───────╯
  ),

  // workman version of home layer
  [LAYER_WORKMAN] = LAYOUT_ergodox_pretty(
// ╭───────┬───────┬───────┬───────┬───────┬───────┬───────╮      ╭───────┬───────┬───────┬───────┬───────┬───────┬───────╮
    KC_GRV ,KC_1   ,KC_2   ,KC_3   ,KC_4   ,KC_5   ,TO_H   ,       XXXXXXX,KC_6   ,KC_7   ,KC_8   ,KC_9   ,KC_0   ,KC_BSPC,
// ├───────┼───────┼───────┼───────┼───────┼───────┼───────┤      ├───────┼───────┼───────┼───────┼───────┼───────┼───────┤
    KC_TAB ,KC_Q   ,KC_D   ,KC_R   ,KC_W   ,KC_B   ,XXXXXXX,       XXXXXXX,KC_J   ,KC_F   ,KC_U   ,KC_P   ,KC_SCLN,KC_BSLS,
// ├───────┼───────┼───────┼───────┼───────┼───────┼───────┤      ├───────┼───────┼───────┼───────┼───────┼───────┼───────┤
    CTL_ESC,KC_A   ,KC_S   ,KC_H   ,KC_T   ,KC_G   ,                       KC_Y   ,KC_N   ,KC_E   ,KC_O   ,KC_I   ,KC_QUOT,
// ├───────┼───────┼───────┼───────┼───────┼───────┤       │      │       ├───────┼───────┼───────┼───────┼───────┼───────┤
    KC_LGUI,KC_Z   ,KC_X   ,KC_M   ,KC_C   ,KC_V   ,KC_MINS,       KC_EQL ,KC_K   ,KC_L   ,KC_COMM,KC_DOT ,KC_SLSH,KC_RGUI,
// ├───────┼───────┼───────┼───────┼───────┼───────┴───────╯      ╰───────┴───────┼───────┼───────┼───────┼───────┼───────┤
    KC_HYPR,_______,QK_LEAD,OSL_T  ,OSL_F  ,                                       OSL_F  ,OSL_T  ,QK_LEAD,XXXXXXX,KC_HYPR,
// ╰───────┴───────┴───────┴───────┴───────╯ ╭───────┬───────╮  ╭───────┬───────╮ ╰───────┴───────┴───────┴───────┴───────╯
                                              KC_MUTE,KC_VOLU,   KC_MPRV,KC_MNXT,
//                                   ╭───────┼───────┼───────┤  ├───────┼───────┼───────╮
                                                      KC_VOLD,   KC_MPLY,
//                                   │       │       ├───────┤  ├───────┤       │       │
                                      LSFT_TA,KC_SPC ,KC_LALT,   KC_RALT,KC_ENT ,RSFT_MI
//                                   ╰───────┴───────┴───────╯  ╰───────┴───────┴───────╯
  ),

  // gaming layer (to be completed)
  [LAYER_GAMING] = LAYOUT_ergodox_pretty(
// ╭───────┬───────┬───────┬───────┬───────┬───────┬───────╮      ╭───────┬───────┬───────┬───────┬───────┬───────┬───────╮
    _______,_______,_______,_______,_______,_______,TO_H   ,       _______,_______,_______,_______,_______,_______,_______,
// ├───────┼───────┼───────┼───────┼───────┼───────┼───────┤      ├───────┼───────┼───────┼───────┼───────┼───────┼───────┤
    _______,_______,_______,_______,_______,_______,_______,       _______,_______,_______,_______,_______,_______,_______,
// ├───────┼───────┼───────┼───────┼───────┼───────┼───────┤      ├───────┼───────┼───────┼───────┼───────┼───────┼───────┤
    _______,_______,_______,_______,_______,_______,                       _______,_______,_______,_______,_______,_______,
// ├───────┼───────┼───────┼───────┼───────┼───────┤       │      │       ├───────┼───────┼───────┼───────┼───────┼───────┤
    _______,_______,_______,_______,_______,_______,_______,       _______,_______,_______,_______,_______,_______,_______,
// ├───────┼───────┼───────┼───────┼───────┼───────┴───────╯      ╰───────┴───────┼───────┼───────┼───────┼───────┼───────┤
    _______,_______,_______,_______,_______,                                       _______,_______,_______,_______,_______,
// ╰───────┴───────┴───────┴───────┴───────╯ ╭───────┬───────╮  ╭───────┬───────╮ ╰───────┴───────┴───────┴───────┴───────╯
                                              _______,_______,   _______,_______,
//                                   ╭───────┼───────┼───────┤  ├───────┼───────┼───────╮
                                                      _______,   _______,
//                                   │       │       ├───────┤  ├───────┤       │       │
                                      _______,_______,_______,   _______,_______,_______
//                                   ╰───────┴───────┴───────╯  ╰───────┴───────┴───────╯
  ),

  // function layer
  [LAYER_FUNCTION] = LAYOUT_ergodox_pretty(
// ╭───────┬───────┬───────┬───────┬───────┬───────┬───────╮      ╭───────┬───────┬───────┬───────┬───────┬───────┬───────╮
    KC_ESC ,KC_F1  ,KC_F2  ,KC_F3  ,KC_F4  ,KC_F5  ,_______,       QK_BOOT,KC_F6  ,KC_F7  ,KC_F8  ,KC_F9  ,KC_F10 ,KC_DEL ,
// ├───────┼───────┼───────┼───────┼───────┼───────┼───────┤      ├───────┼───────┼───────┼───────┼───────┼───────┼───────┤
    _______,KC_PGUP,KC_HOME,KC_UP  ,KC_END ,_______,_______,       _______,_______,_______,_______,KC_F11 ,KC_F12 ,KC_INS ,
// ├───────┼───────┼───────┼───────┼───────┼───────┼───────┤      ├───────┼───────┼───────┼───────┼───────┼───────┼───────┤
    _______,KC_PGDN,KC_LEFT,KC_DOWN,KC_RGHT,_______,                       KC_LEFT,KC_DOWN,KC_UP  ,KC_RGHT,_______,KC_PSCR,
// ├───────┼───────┼───────┼───────┼───────┼───────┤       │      │       ├───────┼───────┼───────┼───────┼───────┼───────┤
    _______,CH_UNSA,_______,KC_LPRN,KC_LBRC,KC_LCBR,_______,       _______,KC_RCBR,KC_RBRC,KC_RPRN,_______,KC_APP ,_______,
// ├───────┼───────┼───────┼───────┼───────┼───────┴───────╯      ╰───────┴───────┼───────┼───────┼───────┼───────┼───────┤
    _______,_______,_______,_______,TO_H   ,                                       TO_H   ,_______,_______,_______,_______,
// ╰───────┴───────┴───────┴───────┴───────╯ ╭───────┬───────╮  ╭───────┬───────╮ ╰───────┴───────┴───────┴───────┴───────╯
                                              _______,_______,   _______,_______,
//                                   ╭───────┼───────┼───────┤  ├───────┼───────┼───────╮
                                                      _______,   _______,
//                                   │       │       ├───────┤  ├───────┤       │       │
                                      _______,_______,_______,   _______,_______,_______
//                                   ╰───────┴───────┴───────╯  ╰───────┴───────┴───────╯
  ),

  // tmux layer — inherits mappings from layer zero, see process_record_user
  [LAYER_TMUX] = LAYOUT_ergodox_pretty(
// ╭───────┬───────┬───────┬───────┬───────┬───────┬───────╮      ╭───────┬───────┬───────┬───────┬───────┬───────┬───────╮
    _______,_______,_______,_______,_______,_______,_______,       _______,_______,_______,_______,_______,_______,_______,
// ├───────┼───────┼───────┼───────┼───────┼───────┼───────┤      ├───────┼───────┼───────┼───────┼───────┼───────┼───────┤
    _______,_______,_______,_______,_______,_______,_______,       _______,_______,_______,_______,_______,_______,_______,
// ├───────┼───────┼───────┼───────┼───────┼───────┼───────┤      ├───────┼───────┼───────┼───────┼───────┼───────┼───────┤
    _______,_______,_______,_______,_______,_______,                       _______,_______,_______,_______,_______,_______,
// ├───────┼───────┼───────┼───────┼───────┼───────┤       │      │       ├───────┼───────┼───────┼───────┼───────┼───────┤
    _______,_______,_______,_______,_______,_______,_______,       _______,_______,_______,_______,_______,_______,_______,
// ├───────┼───────┼───────┼───────┼───────┼───────┴───────╯      ╰───────┴───────┼───────┼───────┼───────┼───────┼───────┤
    _______,_______,_______,TO_H   ,_______,                                       _______,TO_H   ,_______,_______,_______,
// ╰───────┴───────┴───────┴───────┴───────╯ ╭───────┬───────╮  ╭───────┬───────╮ ╰───────┴───────┴───────┴───────┴───────╯
                                              _______,_______,   _______,_______,
//                                   ╭───────┼───────┼───────┤  ├───────┼───────┼───────╮
                                                      _______,   _______,
//                                   │       │       ├───────┤  ├───────┤       │       │
                                      _______,_______,_______,   _______,_______,_______
//                                   ╰───────┴───────┴───────╯  ╰───────┴───────┴───────╯
  ),

  // midi layer
  [LAYER_MIDI] = LAYOUT_ergodox_pretty(
// ╭───────┬───────┬───────┬───────┬───────┬───────┬───────╮      ╭───────┬───────┬───────┬───────┬───────┬───────┬───────╮
    MI_Ds1 ,MI_E1  ,MI_F1  ,MI_Fs1 ,MI_G1  ,MI_Gs1 ,_______,       XXXXXXX,MI_A1  ,MI_As1 ,MI_B1  ,MI_C2  ,MI_Cs2 ,MI_D2  ,
// ├───────┼───────┼───────┼───────┼───────┼───────┼───────┤      ├───────┼───────┼───────┼───────┼───────┼───────┼───────┤
    MI_As  ,MI_B   ,MI_C1  ,MI_Cs1 ,MI_D1  ,MI_Ds1 ,MI_TRSD,       MI_TRSU,MI_E1  ,MI_F1  ,MI_Fs1 ,MI_G1  ,MI_Gs1 ,MI_A1  ,
// ├───────┼───────┼───────┼───────┼───────┼───────┼───────┤      ├───────┼───────┼───────┼───────┼───────┼───────┼───────┤
    MI_F   ,MI_Fs  ,MI_G   ,MI_Gs  ,MI_A   ,MI_As  ,                       MI_B   ,MI_C1  ,MI_Cs1 ,MI_D1  ,MI_Ds1 ,MI_E1  ,
// ├───────┼───────┼───────┼───────┼───────┼───────┤       │      │       ├───────┼───────┼───────┼───────┼───────┼───────┤
    MI_C   ,MI_Cs  ,MI_D   ,MI_Ds  ,MI_E   ,MI_F   ,MI_OCTD,       MI_OCTU,MI_Fs  ,MI_G   ,MI_Gs  ,MI_A   ,MI_As  ,MI_B   ,
// ├───────┼───────┼───────┼───────┼───────┼───────┴───────╯      ╰───────┴───────┼───────┼───────┼───────┼───────┼───────┤
    _______,_______,_______,TO_H   ,_______,                                       _______,TO_H   ,_______,_______,MI_AOFF,
// ╰───────┴───────┴───────┴───────┴───────╯ ╭───────┬───────╮  ╭───────┬───────╮ ╰───────┴───────┴───────┴───────┴───────╯
                                              _______,_______,   _______,_______,
//                                   ╭───────┼───────┼───────┤  ├───────┼───────┼───────╮
                                                      _______,   _______,
//                                   │       │       ├───────┤  ├───────┤       │       │
                                      MI_SUST,MI_CHND,MI_CHNU,   _______,MI_VELD,MI_VELU
//                                   ╰───────┴───────┴───────╯  ╰───────┴───────┴───────╯
  ),

  // game-specific layer
  [LAYER_GS_GGX2] = LAYOUT_ergodox_pretty(
// ╭───────┬───────┬───────┬───────┬───────┬───────┬───────╮      ╭───────┬───────┬───────┬───────┬───────┬───────┬───────╮
    _______,_______,_______,_______,_______,_______,_______,       _______,_______,_______,_______,_______,_______,_______,
// ├───────┼───────┼───────┼───────┼───────┼───────┼───────┤      ├───────┼───────┼───────┼───────┼───────┼───────┼───────┤
    _______,_______,_______,_______,_______,_______,_______,       _______,_______,_______,_______,_______,_______,_______,
// ├───────┼───────┼───────┼───────┼───────┼───────┼───────┤      ├───────┼───────┼───────┼───────┼───────┼───────┼───────┤
    _______,_______,KC_A   ,KC_S   ,KC_D   ,_______,                       _______,_______,_______,_______,_______,_______,
// ├───────┼───────┼───────┼───────┼───────┼───────┤       │      │       ├───────┼───────┼───────┼───────┼───────┼───────┤
    _______,_______,_______,_______,_______,_______,_______,       _______,_______,_______,_______,_______,_______,_______,
// ├───────┼───────┼───────┼───────┼───────┼───────┴───────╯      ╰───────┴───────┼───────┼───────┼───────┼───────┼───────┤
    _______,_______,TO_H   ,_______,_______,                                       _______,_______,TO_H   ,_______,_______,
// ╰───────┴───────┴───────┴───────┴───────╯ ╭───────┬───────╮  ╭───────┬───────╮ ╰───────┴───────┴───────┴───────┴───────╯
                                              _______,_______,   _______,_______,
//                                   ╭───────┼───────┼───────┤  ├───────┼───────┼───────╮
                                                      _______,   _______,
//                                   │       │       ├───────┤  ├───────┤       │       │
                                      KC_W   ,_______,_______,   _______,_______,_______
//                                   ╰───────┴───────┴───────╯  ╰───────┴───────┴───────╯
  ),

  // game-specific layer
  [LAYER_GS_SCB] = LAYOUT_ergodox_pretty(
// ╭───────┬───────┬───────┬───────┬───────┬───────┬───────╮      ╭───────┬───────┬───────┬───────┬───────┬───────┬───────╮
    _______,_______,_______,_______,_______,_______,_______,       _______,_______,_______,_______,_______,_______,_______,
// ├───────┼───────┼───────┼───────┼───────┼───────┼───────┤      ├───────┼───────┼───────┼───────┼───────┼───────┼───────┤
    _______,_______,_______,KC_UP  ,_______,_______,_______,       _______,_______,_______,_______,_______,_______,_______,
// ├───────┼───────┼───────┼───────┼───────┼───────┼───────┤      ├───────┼───────┼───────┼───────┼───────┼───────┼───────┤
    _______,_______,KC_LEFT,KC_DOWN,KC_RGHT,_______,                       _______,KC_Z   ,KC_X   ,_______,_______,_______,
// ├───────┼───────┼───────┼───────┼───────┼───────┤       │      │       ├───────┼───────┼───────┼───────┼───────┼───────┤
    _______,_______,_______,_______,_______,_______,_______,       _______,_______,_______,_______,_______,_______,_______,
// ├───────┼───────┼───────┼───────┼───────┼───────┴───────╯      ╰───────┴───────┼───────┼───────┼───────┼───────┼───────┤
    _______,_______,TO_H   ,_______,_______,                                       _______,_______,TO_H   ,_______,_______,
// ╰───────┴───────┴───────┴───────┴───────╯ ╭───────┬───────╮  ╭───────┬───────╮ ╰───────┴───────┴───────┴───────┴───────╯
                                              _______,_______,   _______,_______,
//                                   ╭───────┼───────┼───────┤  ├───────┼───────┼───────╮
                                                      _______,   _______,
//                                   │       │       ├───────┤  ├───────┤       │       │
                                      _______,_______,_______,   _______,_______,_______
//                                   ╰───────┴───────┴───────╯  ╰───────┴───────┴───────╯
  ),

  // game-specific layer
  [LAYER_GS_TAL] = LAYOUT_ergodox_pretty(
// ╭───────┬───────┬───────┬───────┬───────┬───────┬───────╮      ╭───────┬───────┬───────┬───────┬───────┬───────┬───────╮
    _______,_______,_______,_______,_______,_______,_______,       _______,_______,_______,_______,_______,_______,_______,
// ├───────┼───────┼───────┼───────┼───────┼───────┼───────┤      ├───────┼───────┼───────┼───────┼───────┼───────┼───────┤
    _______,_______,_______,_______,_______,_______,_______,       _______,_______,_______,_______,_______,_______,_______,
// ├───────┼───────┼───────┼───────┼───────┼───────┼───────┤      ├───────┼───────┼───────┼───────┼───────┼───────┼───────┤
    _______,_______,KC_LEFT,KC_DOWN,KC_RGHT,_______,                       _______,KC_1   ,KC_2   ,KC_3   ,KC_4   ,_______,
// ├───────┼───────┼───────┼───────┼───────┼───────┤       │      │       ├───────┼───────┼───────┼───────┼───────┼───────┤
    _______,_______,_______,_______,_______,_______,_______,       _______,_______,_______,_______,_______,_______,_______,
// ├───────┼───────┼───────┼───────┼───────┼───────┴───────╯      ╰───────┴───────┼───────┼───────┼───────┼───────┼───────┤
    _______,_______,TO_H   ,_______,_______,                                       _______,_______,TO_H   ,_______,_______,
// ╰───────┴───────┴───────┴───────┴───────╯ ╭───────┬───────╮  ╭───────┬───────╮ ╰───────┴───────┴───────┴───────┴───────╯
                                              _______,_______,   _______,_______,
//                                   ╭───────┼───────┼───────┤  ├───────┼───────┼───────╮
                                                      _______,   _______,
//                                   │       │       ├───────┤  ├───────┤       │       │
                                      KC_UP  ,_______,_______,   _______,_______,_______
//                                   ╰───────┴───────┴───────╯  ╰───────┴───────┴───────╯
  ),

  // game-specific layer
  [LAYER_GS_ARCUS] = LAYOUT_ergodox_pretty(
// ╭───────┬───────┬───────┬───────┬───────┬───────┬───────╮      ╭───────┬───────┬───────┬───────┬───────┬───────┬───────╮
    _______,_______,_______,_______,_______,_______,_______,       _______,_______,_______,_______,_______,_______,_______,
// ├───────┼───────┼───────┼───────┼───────┼───────┼───────┤      ├───────┼───────┼───────┼───────┼───────┼───────┼───────┤
    _______,_______,_______,_______,_______,_______,_______,       _______,_______,KC_T   ,KC_F   ,KC_V   ,KC_B   ,_______,
// ├───────┼───────┼───────┼───────┼───────┼───────┼───────┤      ├───────┼───────┼───────┼───────┼───────┼───────┼───────┤
    _______,_______,KC_A   ,KC_S   ,KC_D   ,_______,                       _______,KC_G   ,KC_Y   ,KC_U   ,KC_I   ,_______,
// ├───────┼───────┼───────┼───────┼───────┼───────┤       │      │       ├───────┼───────┼───────┼───────┼───────┼───────┤
    _______,_______,_______,_______,_______,_______,_______,       _______,_______,_______,_______,_______,_______,_______,
// ├───────┼───────┼───────┼───────┼───────┼───────┴───────╯      ╰───────┴───────┼───────┼───────┼───────┼───────┼───────┤
    _______,_______,TO_H   ,_______,_______,                                       _______,_______,TO_H   ,_______,_______,
// ╰───────┴───────┴───────┴───────┴───────╯ ╭───────┬───────╮  ╭───────┬───────╮ ╰───────┴───────┴───────┴───────┴───────╯
                                              _______,_______,   _______,_______,
//                                   ╭───────┼───────┼───────┤  ├───────┼───────┼───────╮
                                                      _______,   _______,
//                                   │       │       ├───────┤  ├───────┤       │       │
                                      KC_W   ,_______,_______,   _______,_______,_______
//                                   ╰───────┴───────┴───────╯  ╰───────┴───────┴───────╯
  ),
};

bool kc_task_macos = false;
bool kc_task_release_after_500 = false;
uint16_t kc_task_release_time;

void leader_end_user(void) {
  if (leader_sequence_four_keys(KC_G, KC_G, KC_X, KC_2)) {
    // Guilty Gear XX Accent Core Plus R, aka the final GG X2
    layer_on(LAYER_GS_GGX2);
  } else if (leader_sequence_three_keys(KC_S, KC_C, KC_B)) {
    // Super Crate Box
    layer_on(LAYER_GS_SCB);
  } else if (leader_sequence_three_keys(KC_T, KC_A, KC_L)) {
    // Talented
    layer_on(LAYER_GS_TAL);
  } else if (leader_sequence_three_keys(KC_A, KC_R, KC_C)) {
    // Arcus Chroma
    layer_on(LAYER_GS_ARCUS);
  }
}

void matrix_scan_user(void) {
  if (kc_task_release_after_500) {
    // If this operation is slow, it will only affect performance for 500 ms
    // after a SW_TASK press. The rest of the time, the conditional will prevent
    // any performance cost.
    if (timer_elapsed(kc_task_release_time) > 500) {
       unregister_code(KC_LALT);
       kc_task_release_after_500 = false;
    }
  }
}

bool process_record_user(uint16_t keycode, keyrecord_t *record) {
  if (record->event.pressed) {
    // We only add the Tmux prefix on keydown.
    if (layer_state_cmp(layer_state, LAYER_TMUX)) {
      if (keycode >= KC_A && keycode <= KC_UP) {
        // The key pressed is not a modifier. Store & clear Shifts, then
        // prefix, then apply any stored Shifts, and finally allow the pressed
        // key to be processed.
        uint8_t saved_shifts = get_mods() & MOD_MASK_SHIFT;
        del_mods(saved_shifts);
        tap_code16(C(KC_B));
        add_mods(saved_shifts);
        return true;
      }
    }
    switch(keycode) {
      case SW_TASK:
        kc_task_release_after_500 = false;
        register_code(KC_LALT);
        tap_code(KC_TAB);
        return false;
      case CH_UNSA:
        SEND_STRING("thisisunsafe");
        return false;
    }
  } else {
    switch(keycode) {
      case SW_TASK:
        kc_task_release_after_500 = true;
        kc_task_release_time = timer_read();
        return false;
    }
  }
  return true;
}

uint16_t get_quick_tap_term(uint16_t keycode, keyrecord_t *record) {
    switch (keycode) {
        case CTL_ESC:
        case LSFT_TA:
        case RSFT_MI:
            return 0;
        default:
            return QUICK_TAP_TERM;
    }
}

layer_state_t layer_state_set_user(layer_state_t state) {
  ergodox_board_led_off();
  ergodox_right_led_1_off();
  ergodox_right_led_2_off();
  ergodox_right_led_3_off();

  switch (get_highest_layer(state)) {
    case 1:
      ergodox_right_led_1_on();
      break;
    case 2:
      ergodox_right_led_2_on();
      break;
    case 3:
      ergodox_right_led_3_on();
      break;
    case 4:
      ergodox_right_led_1_on();
      ergodox_right_led_2_on();
      break;
    case 5:
      ergodox_right_led_1_on();
      ergodox_right_led_3_on();
      break;
    case 6:
      ergodox_right_led_2_on();
      ergodox_right_led_3_on();
      break;
    case 7:
      ergodox_right_led_1_on();
      ergodox_right_led_2_on();
      ergodox_right_led_3_on();
      break;
    default:
      break;
  }
  return state;
};
